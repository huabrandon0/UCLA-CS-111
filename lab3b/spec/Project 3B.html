
<!-- saved from url=(0063)http://web.cs.ucla.edu/classes/spring17/cs111/projects/P3B.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Project 3B</title>
<style></style></head>

<body>
<center>
<h1>File System Consistency Analysis</h1>
</center>

<h2>INTRODUCTION:</h2>
<p>
A file system is an example of a large aggregation of complex and highly 
inter-related data structures.  Such systems are often at risk for corruption, 
most commonly resulting from incomplete execution of what should have been 
all-or-none updates.  Unless we can so cleverly design our data structures
and algorithms as to render such errors impossible, it is usually necessary
to articulate consistency assertions and develop a utility to audit
those systems for consistency, and (where possible) repair any detected
anomalies.
In part A of this project we wrote a program to examine on-disk
data structures and summarize their contents.  In this second part,
we will analyze those summaries to detect errors.  
</p>
<p>
All previous projects have been implemented in C, which exposes the
underlying system calls and is well suited for low level operations
on well-defined data structures.  This project involves trivial text
processing (to read .csv input) and the assembly and processing
of an internal state model.  While this can certainly be done in
C, you may find it easier to do in a higher level language (e.g.
Python).  You are free implement this project in any language that 
is supported on the departmental servers (where we will do the testing).
</p>
<h2>RELATION TO READING AND LECTURES:</h2>
<p>
This project more deeply explores the filesystem structures described in
Arpaci chapter 39.<br>
The images we will be working with are EXT2 file systems,
as described in sections 40.2-40.5.<br>
This project goes much deeper than the introductory integrity discussion
in sections 42.1-2.
</p>

<p></p>
<h2> PROJECT OBJECTIVES:</h2>
<ul>
   <li>	Primary: reinforce the basic file system concepts of directory objects,
   	file objects, and free space.</li>
   <li>	Primary: reinforce the implemenation descriptions provided in the text 
   	and lectures.</li>
   <li> Primary: gain experience examining, interpreting and processing
   	information in complex binary data structures.</li>
   <li> Primary: reinforce the notions of consistency and integrity and
   	apply them to a concrete and non-trivial problem.</li>
</ul>
<p></p>
<h2> DELIVERABLES:</h2>
<p>
A single tarball (<tt>.tar.gz</tt>) containing:
</p><ul>

   <li> (at least) one source module that builds/executes cleanly with no errors or warnings).</li>
   <p></p>
   <li> A <tt>Makefile</tt> to build and run the deliverable program.
	The higher level targets should be:
	<ul>
	   <li> default ... compile your program to produce an executable
	   	named <tt>lab3b</tt></li>
	   <li> <strong>dist</strong> ... create the deliverable tarball</li>
	   <li> <strong>clean</strong> ... delete all programs and output
	   	generated by the <tt>Makefile</tt>.</li>
	</ul>
    </li>
   <p></p>
   <p></p>
    <li>a <tt>README</tt> text file containing
	 descriptions of each of the included files and any other information 
	     about your submission that you would like to bring to our attention 
	 (e.g. research, limitations, features, testing methodology, use of slip days).</li>
</ul>
<p></p>

<h2> PROJECT DESCRIPTION:</h2>
<p>
Write a program to analyze a file system summary 
(a <tt>.csv</tt> file like the ones produced in the previous file system project)
and report on all discovered
inconsistencies.
Detected inconsistencies should be reported to standard out.
Execution errors (e.g. invalid arguments or unable to open required files) should be reported to standard error.
</p>
<p>
Your executable should be called <tt>lab3b</tt> and accept 
a single, required, command line argument,
the name of the file to be analyzed.  If your language does not allow a program to have 
such a name, include a shell script (named <tt>lab3b</tt>) that will run program.
</p>
<p>
The results grading for this project will be entirely automated, and messages produced in
an incorrect format will receive no points.  We are providing a
<a href="http://web.cs.ucla.edu/classes/spring17/cs111/projects/P3B_check.sh">sanity check script</a> that will do a simple
validation of your package, and confirm correct output for a two-digit
number of basic errors.  For a simple clean summary, you can use the
<a href="http://web.cs.ucla.edu/classes/spring17/cs111/projects/trivial.csv">correct output sample </a> we provided for the
previous project.  If you want a set of corrupted summaries to test
with, you can pull down copies of the summaries (with names like
<tt>P3B-test_1.csv</tt>) and corresponding
correct output 
(with names like <tt>P3B-test_1.err</tt>) used by the sanity check script.
</p>
<p>
Part of your score will be based on your ability to correctly recognize
and report on the problems in the supplied file system summaries, 
but your program will also be tested on 
several other file systems with a wider range of anomalies.  You can lose points
for mis-reporting errors, failing to report errors, or for reporting errors
that are not present.
</p>
<p>
This is a summary of the errors your program should check for, and a sample 
error message for each:
</p>
<h3> Block Consistency Audits</h3>
<p>
Every block pointer in an I-node or indirect block should be valid 
(a legal data block, within the file system).  
Examine every single block pointer in every single I-node, direct block,
indirect block, double-indirect block, and tripple indirect block to
ascertain that this is true.
If any block pointer is not valid (a legal data block within the file system), 
an error message like one of the
following (depending on precisely the incorrect pointer is found)
should be generated to stdout:
</p>
<pre><tt>
	INVALID BLOCK 101 IN INODE 13 AT OFFSET 0
	INVALID INDIRECT BLOCK 101 IN INODE 13 AT OFFSET 12
	INVALID DOUBLE INDIRECT BLOCK 101 IN INODE 13 AT OFFSET 268
	INVALID TRIPPLE INDIRECT BLOCK 101 IN INODE 13 AT OFFSET 65804
	RESERVED INDIRECT BLOCK 3 IN INODE 13 AT OFFSET 12
	RESERVED DOUBLE INDIRECT BLOCK 3 IN INODE 13 AT OFFSET 268
	RESERVED TRIPPLE INDIRECT BLOCK 3 IN INODE 13 AT OFFSET 65804
	RESERVED BLOCK 3 IN INODE 13 AT OFFSET 0
</tt></pre>
<p>
Note that the reported offsets should be block numbers
(byte offsets divided by 1024).  
The offset associated with an indirect blocks should
be that associated with the first data block it points to
(as in the previous project).
</p>
<p>
Every legal data block 
(every block between the end of the I-nodes and the start of the next group)
should appear on on the free block list, or
be allocated to exactly one file.  Examine the free list to determine
whether or not this is the case.
If a block does not appear in any
file or on the free list, a message like the following should be 
generated to stdout:
</p>
<pre><tt>
	UNREFERENCED BLOCK 37
</tt></pre>
<p>
A block that is allocated to some file might also appear on the free list.
In this case a message like the following should be generated to stdout:
</p>
<pre><tt>
	ALLOCATED BLOCK 8 ON FREELIST
</tt></pre>
<p>
If a block is referenced by multiple files, messages like the following
(depending on precisely where the references are) should be generated
to stdout <u>for each reference to that block</u>:
</p>
<pre><tt>
	DUPLICATE BLOCK 8 IN INODE 13 AT OFFSET 0
	DUPLICATE INDIRECT BLOCK 8 IN INODE 13 AT OFFSET 12
	DUPLICATE DOUBLE INDIRECT BLOCK 8 IN INODE 13 AT OFFSET 268
	DUPLICATE TRIPPLE INDIRECT BLOCK 8 IN INODE 13 AT OFFSET 65804
</tt></pre>
<p>
Note that you will not know that a block is multiply referenced until you find
the second reference.  You will have to figure out a way to go back and report
ALL of the references.
</p>

<h3> I-node Allocation Audits</h3>
<p>
We can tell whether or not an I-node is allocated by looking at its type.
An unallocated I-node should have a type of zero, and an allocated I-node
should have some valid type (e.g. file or directory).  Scan through all
of the I-nodes to determine which are valid/allocated.
Every unallocated should be on a free I-node list.  Compare your list
of allocated/unallocated I-nodes with the free I-node bitmaps, and
for each discovered inconsistency, a message like one of the following should be
generated to stdout:
</p>
<pre><tt>
	ALLOCATED INODE 2 ON FREELIST
	UNALLOCATED INODE 17 NOT ON FREELIST
</tt></pre>
<h3>Directory Consistency Audits</h3>
<p>
Every allocated I-node should be referred to by the a number of directory
entries that is equal to the reference count recorded in the I-node.  
Scan all of the directories to enumerate all links.
</p>
<p>
For any allocated I-node whose reference count does not match the
number of discovered links,
an error message like the following should be generated to stdout.
</p>
<pre><tt>
	INODE 2 HAS 4 LINKS BUT LINKCOUNT IS 5
</tt></pre>
<p>
Directory entries should only refer to valid and allocated I-nodes.
While scanning the directory entries, check the validity and allocation
status of each referenced I-node.  For any reference to an invalid or
unallocated I-node, an error message like the following should be
generated to stdout.
</p>
<pre><tt>
	DIRECTORY INODE 2 NAME 'nullEntry' UNALLOCATED INODE 17
	DIRECTORY INODE 2 NAME 'bogusEntry' INVALID INODE 26
</tt></pre>
<p>
We also know that every directory should begin with two links,
one to itself (<strong>.</strong>) and one to its parent (<strong>..</strong>).
While scanning each directory, check for the validity of these two links
and, for each detected inconsistency, a message like one of the following
should be generated to stdout:
</p>
<pre><tt>
	DIRECTORY INODE 2 NAME '..' LINK TO INODE 11 SHOULD BE 2
	DIRECTORY INODE 11 NAME '.' LINK TO INODE 2 SHOULD BE 11
</tt></pre>

<h3>NOTE</h3>
<p>
As in the previous project, the file system summaries we use to 
test your submission will describe file systems with only a 
single group.
</p>

<h2> SAMPLE DAMAGED FILE SYSTEM SUMMARIES AND OUTPUT </h2>
<p>
The <a href="http://web.cs.ucla.edu/classes/spring17/cs111/projects/P3B_check.sh">sanity check script</a> will automatically
download a large number of damaged file system summaries, run your
program against them, and compare your output with (what I believe
to be) the correct error reports.
</p>
<p>
As with the previous project, your output will be sorted before it 
is compared with the golden results, so the order in which you output
errors is unimportant.
</p>

<h2> SUMMARY OF EXIT CODES:</h2>
<ul>
   <li> 0 ... successful execution, no inconsistencies found. </li>
   <li> 1 ... unsuccessful execution, bad parameters or system call failure. </li>
   <li> 2 ... successful execution, inconsistencies found. </li>
</ul>
<h2> SUBMISSION: </h2>
<p>
Your <strong>README</strong> file must include lines of the form:
</p><ul>
	<strong>NAME:</strong> <em>your name(s)</em><br>
	<strong>EMAIL:</strong> <em>your email(s)</em><br>
	<strong>ID:</strong> <em>your student ID(s)</em>
</ul>
Your name, student ID, and email address  should also appear as comments at the top
of your <tt>Makefile</tt> and each source file.  If this is a team submission, the
names, e-mail addresses, and student IDs should be comma-separated.
<p></p>
<p>
Your tarball should have a name of the form <tt>lab3b-</tt><em>studentID</em><tt>.tar.gz</tt>.<br>
You can sanity check your submission with this 
<a href="http://web.cs.ucla.edu/classes/spring17/cs111/projects/P3B_check.sh">test script</a>.<br>
<u>Projects that do not pass the test script will not be accepted!</u>
</p>
<p>
We will test it on a departmental Linux server.  
You would be well advised to test your submission on that platform before submitting it.
</p>

<h2> GRADING: </h2>
<p>
Points for this project will be awarded:
</p>
<div align="center">
<table><tbody>
<tr> <th>value</th>	<th align="left">feature</th></tr>

<tr> <td></td>		<th align="left">Packaging and build (10% total)</th></tr>
<tr> <td>3%</td>	<td>un-tars expected contents</td></tr>
<tr> <td>3%</td>	<td>clean build</td></tr>
<tr> <td>2%</td>	<td>correct <tt>clean</tt> and <tt>dist</tt> targets</td></tr>
<tr> <td>2%</td>	<td>reasonableness of <tt>README</tt> contents</td></tr>

<tr> <td></td> </tr>
<tr> <td></td>		<th align="left">Results (80% total)</th></tr>
<tr> <td>10%</td>	<td>illegal block pointer detection and reporting</td></tr>
<tr> <td>10%</td>	<td>reserved block pointer detection and reporting</td></tr>
<tr> <td>5%</td>	<td>unallocated block detection and reporting</td></tr>
<tr> <td>15%</td>	<td>duplicately referenced block detection and reporting</td></tr>
<tr> <td></td> </tr>
<tr> <td>5%</td>	<td>I-node allocation and free list error detection and reporting</td></tr>
<tr> <td></td> </tr>
<tr> <td>10%</td>	<td>incorrect link count detection and reporting</td></tr>
<tr> <td>5%</td>	<td>unreferenced I-node detection and reporting</td></tr>
<tr> <td>5%</td>	<td>invalid I-node in directory entry detection and reporting</td></tr>
<tr> <td>5%</td>	<td>unallocated I-node in directory entry detection and reporting</td></tr>
<tr> <td>10%</td>	<td>., .. error detection and reporting</td></tr>

<tr> <td></td> </tr>
<tr> <td></td>		<th align="left">Code Review (10%)</th></tr>
<tr> <td>5%</td>	<td>intelligent choice of language and exploitation of its features</td></tr>
<tr> <td>5%</td>	<td>general organization and readability</td></tr>

</tbody></table>
</div>



</body></html>